import{f as J,z as K,u as W,A as X,s as Y,r as C,B as Q,g as Z,j as O,o as i,c as m,a as l,w as s,d as x,i as B,C as ee,h as te,y as M,W as U,b as p,p as I,q as L,e as le,E as ae,D as ne,G as se,H as oe,I as ue,J as ie,K as re,L as de,l as me,v as pe,X as ce,t as _e,x as ye,Y as fe}from"./index-CUFw-OIo.js";/* empty css                   *//* empty css                 *//* empty css                  *//* empty css                     *//* empty css               *//* empty css                *//* empty css                           */import{u as ve}from"./userArmies-ITDP9y9w.js";import{u as he,U as be,a as ge}from"./userUnits-Ct38ncnW.js";import"./timestamp_pb-CZi0KM27.js";const Ue={class:"user-armies-edit-unit"},Ve=p("br",null,null,-1),Se=p("br",null,null,-1),Ne=p("br",null,null,-1),xe=p("br",null,null,-1),Me={key:0,style:{height:"1000px"}},Te=["width"],we=["innerHTML"],ke={style:{display:"flex","align-items":"center"}},Ee={key:0},qe={key:1},Ae={key:2},Oe=["innerHTML"],Ce={key:3},Je=J({__name:"EditUnitView",setup(Be){const V=K(),R=W(),P=ve(),z=he(),j=X(),{loading:D}=Y(R),H=C(""),F=C("");let c=C();const e=Q({name:"",quantity:1,minModels:0,maxModels:0,points:0,options:[]}),T=async function(){var o,u,f,_,d,v,w,k,E,q;let r=0;r+=e.quantity*Number((u=(o=c.value)==null?void 0:o.unitType)==null?void 0:u.pointsPerModel);for(let S=0;S<e.options.length;S++){const t=e.options[S],b=t.perModel?e.quantity:1;switch(t.unitOptionTypeName){case"Single":(f=t.value)!=null&&f.isSelected&&(r+=b*Number(t.points));break;case"One Of":if(console.log((_=t.value)==null?void 0:_.indexSelected),(d=t.value)!=null&&d.indexSelected.length)for(let y=0;y<t.items.length;y++)t.items[y].id==((v=t.value)==null?void 0:v.indexSelected)&&(r+=b*Number(t.items[y].points));break;case"Many Of":if(((w=t.value)==null?void 0:w.idsSelected.length)>0){const y=(k=t.value)==null?void 0:k.idsSelected;for(let N=0;N<y.length;N++)for(let g=0;g<t.items.length;g++)t.items[g].id==y[N]&&(r+=b*Number(t.items[g].points))}break;case"Many To":((E=t.value)==null?void 0:E.qtySelected)>0&&(r+=Number((q=t.value)==null?void 0:q.qtySelected)*Number(t.points));break;default:console.log(t.unitOptionTypeName," not handled for points calculation")}}e.points=r};async function $(){const r=new be({id:V.params.armyunitid,qty:{value:BigInt(e.quantity),case:"qtyValue"},points:BigInt(e.points)});for(let u=0;u<e.options.length;u++)r.optionValues.push(e.options[u].value);const o=await z.updateUnit(new ge({updateArmyUnit:r}));if(o){O.error(o);return}O.success("Successfully updated user army unit"),j.push(`/user-armies/edit/${V.params.userarmyid}`)}async function G(){var u,f,_,d;const[r,o]=await z.getUnit(V.params.armyunitid);if(o){O.error(o);return}c.value=r,e.name=(u=c.value.unitType)==null?void 0:u.name,e.quantity=Number(c.value.quantity),e.options=(f=c.value.unitType)==null?void 0:f.options,e.points=Number(c.value.points),e.minModels=Number((_=c.value.unitType)==null?void 0:_.minModels),e.maxModels=Number((d=c.value.unitType)==null?void 0:d.maxModels)}return Z(async()=>{const[r,o]=await P.getUserArmy(V.params.userarmyid);if(o){O.error(o);return}const u=r;H.value=u.name,F.value=u.armyTypeId,await G()}),(r,o)=>{const u=le,f=ae,_=ne,d=se,v=oe,w=ue,k=ie,E=re,q=de,S=ce,t=_e,b=ye,y=fe,N=me,g=pe;return i(),m("div",Ue,[l(f,{separator:"/"},{default:s(()=>[l(u,{to:{path:"/"}},{default:s(()=>[x("Homepage")]),_:1}),l(u,{to:{path:"/user-armies"}},{default:s(()=>[x("User Armies")]),_:1}),l(u,{to:{path:`/user-armies/edit/${B(V).params.userarmyid}`}},{default:s(()=>[x(ee(H.value),1)]),_:1},8,["to"]),l(u,null,{default:s(()=>[x("Add Unit")]),_:1})]),_:1}),Ve,Se,l(q,{class:"row-bg",justify:"space-between"},{default:s(()=>[l(_,{span:4}),l(_,{span:10},{default:s(()=>[l(E,null,{default:s(()=>[te((i(),M(k,{model:e,"label-width":"auto",style:{"max-height":"600px"}},{default:s(()=>{var A,n;return[l(v,{label:"Name"},{default:s(()=>[l(d,{modelValue:e.name,"onUpdate:modelValue":o[0]||(o[0]=h=>e.name=h),disabled:""},null,8,["modelValue"])]),_:1}),l(v,{label:"Points"},{default:s(()=>[l(d,{modelValue:e.points,"onUpdate:modelValue":o[1]||(o[1]=h=>e.points=h),disabled:""},null,8,["modelValue"])]),_:1}),e.maxModels>1?(i(),M(v,{key:0,label:"Num Models - "+((n=(A=B(c))==null?void 0:A.unitType)==null?void 0:n.pointsPerModel)+" pts per model"},{default:s(()=>[l(d,{modelValue:e.quantity,"onUpdate:modelValue":o[2]||(o[2]=h=>e.quantity=h),min:e.minModels,max:e.maxModels,onChange:T},null,8,["modelValue","min","max"])]),_:1},8,["label"])):U("",!0),l(v,null,{default:s(()=>[l(w,{type:"primary",onClick:$},{default:s(()=>[x("Save")]),_:1})]),_:1})]}),_:1},8,["model"])),[[g,B(D)]])]),_:1})]),_:1}),l(_,{span:4})]),_:1}),Ne,xe,e.options.length>0?(i(),m("div",Me,[l(N,null,{default:s(({width:A})=>[p("table",{width:A},[p("tbody",null,[(i(!0),m(I,null,L(e.options,(n,h)=>(i(),m("tr",{key:h},[p("td",{innerHTML:n.txt+(n.points>0?" ("+n.points+"pts"+(n.perModel?" per model)":")"):"")},null,8,we),p("td",null,[p("div",ke,[n.unitOptionTypeName=="Single"?(i(),m("div",Ee,[l(S,{modelValue:n.value.isSelected,"onUpdate:modelValue":a=>n.value.isSelected=a,onChange:T,size:"large"},null,8,["modelValue","onUpdate:modelValue"])])):U("",!0),n.unitOptionTypeName=="One Of"?(i(),m("div",qe,[l(b,{modelValue:n.value.indexSelected,"onUpdate:modelValue":a=>n.value.indexSelected=a,size:"large",onChange:T,style:{width:"300px"}},{default:s(()=>[(i(),M(t,{key:"",label:"-- No option selected --",value:""})),(i(!0),m(I,null,L(n.items,a=>(i(),M(t,{key:a.id,label:"("+a.points+"pts) "+a.name,value:a.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):U("",!0),n.unitOptionTypeName=="Many Of"?(i(),m("div",Ae,[l(b,{modelValue:n.value.idsSelected,"onUpdate:modelValue":a=>n.value.idsSelected=a,multiple:"",filterable:"",size:"large",onChange:T,style:{width:"300px"}},{default:s(()=>[(i(!0),m(I,null,L(n.items,a=>(i(),M(t,{key:a.id,label:"("+a.points+"pts) "+a.name+" - "+a.itemTypeName,value:a.id},{default:s(()=>[l(y,{placement:"right-start",width:200,trigger:"hover",content:a.description},{reference:s(()=>[p("span",{innerHTML:"("+a.points+"pts) "+a.name+" - "+a.itemTypeName},null,8,Oe)]),_:2},1032,["content"])]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):U("",!0),n.unitOptionTypeName=="Many To"?(i(),m("div",Ce,[l(d,{modelValue:n.value.qtySelected,"onUpdate:modelValue":a=>n.value.qtySelected=a,type:"number",min:"0"},null,8,["modelValue","onUpdate:modelValue"])])):U("",!0)])])]))),128))])],8,Te)]),_:1})])):U("",!0)])}}});export{Je as default};
