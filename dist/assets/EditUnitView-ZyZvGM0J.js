import{f as J,z as K,u as W,C as X,s as Y,r as O,D as Q,g as Z,j as M,o as i,c as d,a as l,w as n,d as w,i as z,A as ee,h as te,y as T,W as U,b as m,p as C,q as B,e as le,E as ae,G as ne,I as oe,H as se,J as ue,K as ie,L as re,M as de,l as me,v as ce,X as pe,t as _e,x as ye,Y as fe}from"./index-DuBop9t4.js";/* empty css                     *//* empty css                 *//* empty css                  *//* empty css               *//* empty css                *//* empty css                           */import{u as ve}from"./userArmies-CGtMzVZB.js";import{u as he,U as be,a as ge}from"./userUnits-3f3ZWzc7.js";import"./timestamp_pb-DtOAgJG7.js";const Ue={class:"user-armies-edit-unit"},Ve=m("br",null,null,-1),Se=m("br",null,null,-1),Ne=m("br",null,null,-1),we=m("br",null,null,-1),Te={key:0,style:{height:"1000px"}},xe=["width"],ke=["innerHTML"],Ee={style:{display:"flex","align-items":"center"}},qe={key:0},Me={key:1},Ae={key:2},Oe=["innerHTML"],Ce={key:3},Ge=J({__name:"EditUnitView",setup(Be){const V=K(),H=W(),R=ve(),I=he(),P=X(),{loading:j}=Y(H),L=O(""),D=O("");let v=O();const e=Q({name:"",quantity:1,minModels:0,maxModels:0,points:0,options:[]}),A=async function(){var o,s,p,h,_,y,x,k,E,q;let r=0;r+=e.quantity*Number((s=(o=v.value)==null?void 0:o.unitType)==null?void 0:s.pointsPerModel);for(let S=0;S<e.options.length;S++){const t=e.options[S],b=t.perModel?e.quantity:1;switch(t.unitOptionTypeName){case"Single":(p=t.value)!=null&&p.isSelected&&(r+=b*Number(t.points));break;case"One Of":if(console.log((h=t.value)==null?void 0:h.indexSelected),(_=t.value)!=null&&_.indexSelected.length)for(let c=0;c<t.items.length;c++)t.items[c].id==((y=t.value)==null?void 0:y.indexSelected)&&(r+=b*Number(t.items[c].points));break;case"Many Of":if(((x=t.value)==null?void 0:x.idsSelected.length)>0){const c=(k=t.value)==null?void 0:k.idsSelected;for(let N=0;N<c.length;N++)for(let g=0;g<t.items.length;g++)t.items[g].id==c[N]&&(r+=b*Number(t.items[g].points))}break;case"Many To":((E=t.value)==null?void 0:E.qtySelected)>0&&(r+=Number((q=t.value)==null?void 0:q.qtySelected)*Number(t.points));break;default:console.log(t.unitOptionTypeName," not handled for points calculation")}}console.log("calculatePoints: ",e.points),e.points=r};async function F(){const r=new be({id:V.params.armyunitid,qty:{value:BigInt(e.quantity),case:"qtyValue"},points:BigInt(e.points)});for(let s=0;s<e.options.length;s++)r.optionValues.push(e.options[s].value);const o=await I.updateUnit(new ge({updateArmyUnit:r}));if(o){M.error(o);return}M.success("Successfully updated user army unit"),P.push(`/user-armies/edit/${V.params.userarmyid}`)}async function $(){var s,p;const[r,o]=await I.getUnit(V.params.armyunitid);if(o){M.error(o);return}v.value=r,e.name=(s=v.value.unitType)==null?void 0:s.name,e.quantity=Number(v.value.quantity),e.options=(p=v.value.unitType)==null?void 0:p.options,e.points=Number(v.value.points)}return Z(async()=>{const[r,o]=await R.getUserArmy(V.params.userarmyid);if(o){M.error(o);return}const s=r;L.value=s.name,D.value=s.armyTypeId,await $()}),(r,o)=>{const s=le,p=ae,h=ne,_=oe,y=se,x=ue,k=ie,E=re,q=de,S=pe,t=_e,b=ye,c=fe,N=me,g=ce;return i(),d("div",Ue,[l(p,{separator:"/"},{default:n(()=>[l(s,{to:{path:"/"}},{default:n(()=>[w("Homepage")]),_:1}),l(s,{to:{path:"/user-armies"}},{default:n(()=>[w("User Armies")]),_:1}),l(s,{to:{path:`/user-armies/edit/${z(V).params.userarmyid}`}},{default:n(()=>[w(ee(L.value),1)]),_:1},8,["to"]),l(s,null,{default:n(()=>[w("Add Unit")]),_:1})]),_:1}),Ve,Se,l(q,{class:"row-bg",justify:"space-between"},{default:n(()=>[l(h,{span:4}),l(h,{span:10},{default:n(()=>[l(E,null,{default:n(()=>[te((i(),T(k,{model:e,"label-width":"auto",style:{"max-height":"600px"}},{default:n(()=>[l(y,{label:"Name"},{default:n(()=>[l(_,{modelValue:e.name,"onUpdate:modelValue":o[0]||(o[0]=f=>e.name=f),disabled:""},null,8,["modelValue"])]),_:1}),l(y,{label:"Points"},{default:n(()=>[l(_,{modelValue:e.points,"onUpdate:modelValue":o[1]||(o[1]=f=>e.points=f),disabled:""},null,8,["modelValue"])]),_:1}),e.maxModels>1?(i(),T(y,{key:0,label:"Num Models"},{default:n(()=>[l(_,{modelValue:e.quantity,"onUpdate:modelValue":o[2]||(o[2]=f=>e.quantity=f),type:"number"},null,8,["modelValue"])]),_:1})):U("",!0),l(y,null,{default:n(()=>[l(x,{type:"primary",onClick:F},{default:n(()=>[w("Save")]),_:1})]),_:1})]),_:1},8,["model"])),[[g,z(j)]])]),_:1})]),_:1}),l(h,{span:4})]),_:1}),Ne,we,e.options.length>0?(i(),d("div",Te,[l(N,null,{default:n(({width:f})=>[m("table",{width:f},[m("tbody",null,[(i(!0),d(C,null,B(e.options,(u,G)=>(i(),d("tr",{key:G},[m("td",{innerHTML:u.txt},null,8,ke),m("td",null,[m("div",Ee,[u.unitOptionTypeName=="Single"?(i(),d("div",qe,[l(S,{modelValue:u.value.isSelected,"onUpdate:modelValue":a=>u.value.isSelected=a,onChange:A,size:"large"},null,8,["modelValue","onUpdate:modelValue"])])):U("",!0),u.unitOptionTypeName=="One Of"?(i(),d("div",Me,[l(b,{modelValue:u.value.indexSelected,"onUpdate:modelValue":a=>u.value.indexSelected=a,size:"large",onChange:A,style:{width:"300px"}},{default:n(()=>[(i(),T(t,{key:"",label:"-- No option selected --",value:""})),(i(!0),d(C,null,B(u.items,a=>(i(),T(t,{key:a.id,label:"("+a.points+"pts) "+a.name,value:a.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):U("",!0),u.unitOptionTypeName=="Many Of"?(i(),d("div",Ae,[l(b,{modelValue:u.value.idsSelected,"onUpdate:modelValue":a=>u.value.idsSelected=a,multiple:"",filterable:"",size:"large",onChange:A,style:{width:"300px"}},{default:n(()=>[(i(!0),d(C,null,B(u.items,a=>(i(),T(t,{key:a.id,label:"("+a.points+"pts) "+a.name+" - "+a.itemTypeName,value:a.id},{default:n(()=>[l(c,{placement:"right-start",width:200,trigger:"hover",content:a.description},{reference:n(()=>[m("span",{innerHTML:"("+a.points+"pts) "+a.name+" - "+a.itemTypeName},null,8,Oe)]),_:2},1032,["content"])]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):U("",!0),u.unitOptionTypeName=="Many To"?(i(),d("div",Ce,[l(_,{modelValue:u.value.qtySelected,"onUpdate:modelValue":a=>u.value.qtySelected=a,type:"number",min:"0"},null,8,["modelValue","onUpdate:modelValue"])])):U("",!0)])])]))),128))])],8,xe)]),_:1})])):U("",!0)])}}});export{Ge as default};
