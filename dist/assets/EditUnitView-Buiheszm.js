import{f as J,C as K,u as Z,D as Q,s as W,g as B,G as X,k as Y,n as h,o as u,c as m,a as l,w as o,d as w,l as I,H as ee,m as te,B as k,Z as S,b as p,j as L,y as z,e as le,E as ae,I as ne,J as oe,K as se,L as ie,M as ue,N as re,O as de,t as me,v as pe,_ as ce,z as _e,A as ye,$ as fe}from"./index-Bo4L7-t_.js";/* empty css                   *//* empty css                 *//* empty css                  *//* empty css                     *//* empty css               *//* empty css                *//* empty css                           */import{u as ve}from"./userArmies-C8TETVPB.js";import{u as ge,U as he,a as be}from"./userUnits-BSIg7AYT.js";import"./types_pb-DoulQPha.js";import"./timestamp_pb-CFeAd6Js.js";const Ue={class:"user-armies-edit-unit"},Ve=p("br",null,null,-1),Se=p("br",null,null,-1),Ne=p("br",null,null,-1),Me=p("br",null,null,-1),xe={key:0,style:{height:"1000px"}},Te=["width"],we=["innerHTML"],ke={style:{display:"flex","align-items":"center"}},Ee={key:0},qe={key:1},Oe={key:2},Ae=["innerHTML"],Ce={key:3},Ke=J({__name:"EditUnitView",setup(Be){const N=K(),b=Z(),P=ve(),H=ge(),j=Q(),{loading:D}=W(b),R=B(""),F=B("");let c=B();const e=X({name:"",quantity:1,minModels:0,maxModels:0,points:0,options:[]}),M=async function(){var s,i,f,_,d,v,E,q,O,A;let r=0;r+=e.quantity*Number((i=(s=c.value)==null?void 0:s.unitType)==null?void 0:i.pointsPerModel);for(let x=0;x<e.options.length;x++){const t=e.options[x],U=t.perModel?e.quantity:1;switch(t.unitOptionTypeName){case"Single":(f=t.value)!=null&&f.isSelected&&(r+=U*Number(t.points));break;case"One Of":if(console.log((_=t.value)==null?void 0:_.indexSelected),(d=t.value)!=null&&d.indexSelected.length)for(let y=0;y<t.items.length;y++)t.items[y].id==((v=t.value)==null?void 0:v.indexSelected)&&(r+=U*Number(t.items[y].points));break;case"Many Of":if(((E=t.value)==null?void 0:E.idsSelected.length)>0){const y=(q=t.value)==null?void 0:q.idsSelected;for(let T=0;T<y.length;T++)for(let V=0;V<t.items.length;V++)t.items[V].id==y[T]&&(r+=U*Number(t.items[V].points))}break;case"Many To":((O=t.value)==null?void 0:O.qtySelected)>0&&(r+=Number((A=t.value)==null?void 0:A.qtySelected)*Number(t.points));break;default:console.log(t.unitOptionTypeName," not handled for points calculation")}}e.points=r};async function $(){h.info("attempting to save unit edits"),b.loading=!0;const r=new he({id:N.params.armyunitid,qty:{value:BigInt(e.quantity),case:"qtyValue"},points:BigInt(e.points)});for(let i=0;i<e.options.length;i++)r.optionValues.push(e.options[i].value);const s=await H.updateUnit(new be({updateArmyUnit:r}));if(s){h.error(s);return}b.loading=!1,h.success("Successfully updated user army unit"),j.push(`/user-armies/edit/${N.params.userarmyid}`)}async function G(){var i,f,_,d;h.info("getting user unit data"),b.loading=!0;const[r,s]=await H.getUnit(N.params.armyunitid);if(s){h.error(s);return}c.value=r,e.name=(i=c.value.unitType)==null?void 0:i.name,e.quantity=Number(c.value.quantity),e.options=(f=c.value.unitType)==null?void 0:f.options,e.points=Number(c.value.points),e.minModels=Number((_=c.value.unitType)==null?void 0:_.minModels),e.maxModels=Number((d=c.value.unitType)==null?void 0:d.maxModels),b.loading=!1}return Y(async()=>{b.loading=!0,h.info("getting edit user unit army data");const[r,s]=await P.getUserArmy(N.params.userarmyid);if(s){h.error(s);return}const i=r;R.value=i.name,F.value=i.armyTypeId,await G()}),(r,s)=>{const i=le,f=ae,_=ne,d=oe,v=se,E=ie,q=ue,O=re,A=de,x=ce,t=_e,U=ye,y=fe,T=me,V=pe;return u(),m("div",Ue,[l(f,{separator:"/"},{default:o(()=>[l(i,{to:{path:"/"}},{default:o(()=>[w("Homepage")]),_:1}),l(i,{to:{path:"/user-armies"}},{default:o(()=>[w("User Armies")]),_:1}),l(i,{to:{path:`/user-armies/edit/${I(N).params.userarmyid}`}},{default:o(()=>[w(ee(R.value),1)]),_:1},8,["to"]),l(i,null,{default:o(()=>[w("Edit Unit")]),_:1})]),_:1}),Ve,Se,l(A,{class:"row-bg",justify:"space-between"},{default:o(()=>[l(_,{span:4}),l(_,{span:10},{default:o(()=>[l(O,null,{default:o(()=>[te((u(),k(q,{model:e,"label-width":"auto",style:{"max-height":"600px"}},{default:o(()=>{var C,n;return[l(v,{label:"Name"},{default:o(()=>[l(d,{modelValue:e.name,"onUpdate:modelValue":s[0]||(s[0]=g=>e.name=g),disabled:""},null,8,["modelValue"])]),_:1}),l(v,{label:"Points"},{default:o(()=>[l(d,{modelValue:e.points,"onUpdate:modelValue":s[1]||(s[1]=g=>e.points=g),disabled:""},null,8,["modelValue"])]),_:1}),e.maxModels>1?(u(),k(v,{key:0,label:"Num Models - "+((n=(C=I(c))==null?void 0:C.unitType)==null?void 0:n.pointsPerModel)+" pts per model"},{default:o(()=>[l(d,{modelValue:e.quantity,"onUpdate:modelValue":s[2]||(s[2]=g=>e.quantity=g),min:e.minModels,max:e.maxModels,onChange:M},null,8,["modelValue","min","max"])]),_:1},8,["label"])):S("",!0),l(v,null,{default:o(()=>[l(E,{type:"primary",onClick:$},{default:o(()=>[w("Save")]),_:1})]),_:1})]}),_:1},8,["model"])),[[V,I(D)]])]),_:1})]),_:1}),l(_,{span:4})]),_:1}),Ne,Me,e.options.length>0?(u(),m("div",xe,[l(T,null,{default:o(({width:C})=>[p("table",{width:C},[p("tbody",null,[(u(!0),m(L,null,z(e.options,(n,g)=>(u(),m("tr",{key:g},[p("td",{innerHTML:n.txt+(n.points>0?" ("+n.points+"pts"+(n.perModel?" per model)":")"):"")},null,8,we),p("td",null,[p("div",ke,[n.unitOptionTypeName=="Single"?(u(),m("div",Ee,[l(x,{modelValue:n.value.isSelected,"onUpdate:modelValue":a=>n.value.isSelected=a,onChange:M,size:"large"},null,8,["modelValue","onUpdate:modelValue"])])):S("",!0),n.unitOptionTypeName=="One Of"?(u(),m("div",qe,[l(U,{modelValue:n.value.indexSelected,"onUpdate:modelValue":a=>n.value.indexSelected=a,size:"large",onChange:M,style:{width:"300px"}},{default:o(()=>[(u(),k(t,{key:"",label:"-- No option selected --",value:""})),(u(!0),m(L,null,z(n.items,a=>(u(),k(t,{key:a.id,label:"("+a.points+"pts) "+a.name,value:a.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):S("",!0),n.unitOptionTypeName=="Many Of"?(u(),m("div",Oe,[l(U,{modelValue:n.value.idsSelected,"onUpdate:modelValue":a=>n.value.idsSelected=a,multiple:"",filterable:"",size:"large",onChange:M,style:{width:"300px"}},{default:o(()=>[(u(!0),m(L,null,z(n.items,a=>(u(),k(t,{key:a.id,label:"("+a.points+"pts) "+a.name+" - "+a.itemTypeName,value:a.id},{default:o(()=>[l(y,{placement:"right-start",width:200,trigger:"hover",content:a.description},{reference:o(()=>[p("span",{innerHTML:"("+a.points+"pts) "+a.name+" - "+a.itemTypeName},null,8,Ae)]),_:2},1032,["content"])]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):S("",!0),n.unitOptionTypeName=="Many To"?(u(),m("div",Ce,[l(d,{modelValue:n.value.qtySelected,"onUpdate:modelValue":a=>n.value.qtySelected=a,type:"number",min:"0",onChange:M},null,8,["modelValue","onUpdate:modelValue"])])):S("",!0)])])]))),128))])],8,Te)]),_:1})])):S("",!0)])}}});export{Ke as default};
